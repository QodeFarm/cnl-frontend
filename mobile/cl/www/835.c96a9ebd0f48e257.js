"use strict";(self.webpackChunkcnl=self.webpackChunkcnl||[]).push([[835],{9987:(E,y,_)=>{_.r(y),_.d(y,{WorkorderComponent:()=>W});var b=_(6814),g=_(3929),r=_(5879),k=_(7871),O=_(2787),C=_(9862);let w=(()=>{class u{refreshTable(){this.taTableComponent?.refresh()}constructor(e,t){this.router=e,this.http=t,this.edit=new r.vpe,this.tableConfig={apiUrl:"production/work_order/",showCheckbox:!0,title:"Work Order",pkId:"work_order_id",fixedFilters:[],pageSize:10,globalSearch:{keys:["start_date","product","size","color","quantity","completed_qty","pending_qty","status_id","end_date"]},defaultSort:{key:"created_at",value:"descend"},cols:[{fieldKey:"product",name:"Product",sort:!0,displayType:"map",mapFn:(o,i,l)=>i.product.name},{fieldKey:"size",name:"Size",sort:!0,displayType:"map",mapFn:(o,i,l)=>i?.size?.size_name},{fieldKey:"color",name:"Color",sort:!0,displayType:"map",mapFn:(o,i,l)=>i?.color?.color_name},{fieldKey:"quantity",name:"Quantity",sort:!0},{fieldKey:"completed_qty",name:"Completed QTY",sort:!0},{fieldKey:"pending_qty",name:"Pending QTY",sort:!1},{fieldKey:"status_id",name:"Status",displayType:"map",mapFn:(o,i,l)=>`${i.status.status_name}`,sort:!0},{fieldKey:"order_no",name:"Sale Order",displayType:"map",mapFn:(o,i,l)=>`${i.sale_order.order_no}`,sort:!0},{fieldKey:"status_name",name:"Flow Status",displayType:"map",mapFn:(o,i,l)=>`${i.sale_order.status_name}`,sort:!0},{fieldKey:"end_date",name:"End Date",sort:!0},{fieldKey:"code",name:"Action",type:"action",actions:[{type:"delete",label:"Delete",confirm:!0,confirmMsg:"Sure to delete?",apiUrl:"production/work_order"},{type:"callBackFn",icon:"fa fa-pen",label:"",callBackFn:(o,i)=>{console.log(o),this.edit.emit(o.work_order_id)}}]}]}}}return u.\u0275fac=function(e){return new(e||u)(r.Y36(O.F0),r.Y36(C.eN))},u.\u0275cmp=r.Xpm({type:u,selectors:[["app-work-order-list"]],viewQuery:function(e,t){if(1&e&&r.Gf(k.Z,5),2&e){let o;r.iGM(o=r.CRH())&&(t.taTableComponent=o.first)}},outputs:{edit:"edit"},standalone:!0,features:[r.jDz],decls:1,vars:1,consts:[[1,"custom-list",3,"options"]],template:function(e,t){1&e&&r._UZ(0,"ta-table",0),2&e&&r.Q6J("options",t.tableConfig)},dependencies:[b.ez,g.l,k.Z]}),u})();var z=_(7127);function v(u,f){1&u&&(r.TgZ(0,"span",19),r._uU(1,"Update Work Order"),r.qZA())}function q(u,f){1&u&&(r.TgZ(0,"span",19),r._uU(1,"Create Work Order"),r.qZA())}function T(u,f){if(1&u){const e=r.EpF();r.TgZ(0,"button",20),r.NdJ("click",function(){r.CHM(e);const o=r.oxw();return r.KtG(o.createBom())}),r._uU(1,"Create BOM "),r.qZA()}if(2&u){const e=r.oxw();r.Q6J("disabled",e.isBomButtonDisabled)}}function x(u,f){if(1&u&&(r.TgZ(0,"div",21),r._UZ(1,"ta-form",22),r.qZA()),2&u){const e=r.oxw();r.xp6(1),r.Q6J("options",e.formConfig)}}function I(u,f){if(1&u){const e=r.EpF();r.TgZ(0,"div",23)(1,"app-work-order-list",24),r.NdJ("edit",function(o){r.CHM(e);const i=r.oxw();return r.KtG(i.editWorkorder(o))}),r.qZA()()}}let W=(()=>{class u{constructor(e,t,o){this.http=e,this.el=t,this.renderer=o,this.showCreateBomButton=!1,this.isBomButtonDisabled=!1,this.showWorkorderList=!1,this.showForm=!0,this.formConfig={},this.editMode=!1,this.curdConfig={drawerSize:500,drawerPlacement:"top",tableConfig:{apiUrl:"products/colors/",pageSize:10},formConfig:{url:"products/colors/",title:"BOM",pkId:"bom_id",exParams:[],fields:[{fieldGroupClassName:"ant-row custom-form-block",fieldGroup:[{key:"bom_name",type:"input",className:"",templateOptions:{label:"BOM Name",placeholder:"Enter BOM Name",required:!0}},{key:"notes",type:"textarea",className:"",templateOptions:{label:"Notes",placeholder:"Enter Notes",required:!0}}]}]}}}ngOnInit(){this.showWorkorderList=!1,this.showForm=!0,this.setFormConfig(),history.state&&(history.state.productDetails||history.state.saleOrderDetails)&&(this.populateFormWithData(history.state),this.showForm=!0),this.hideFields(!0)}hideFields(e){[5,6,4,9].forEach(o=>{this.formConfig.fields[0].fieldGroup[o].hide=e})}hide(){const e=document.getElementById("modalClose");e&&e.click()}makeFieldsNotTouchable(e){e.forEach(t=>{const o=this.formConfig.fields[0].fieldGroup[t];o&&(o.templateOptions.disabled=!0)})}editWorkorder(e){this.editMode=!0,this.showCreateBomButton=!1,this.hideFields(!1),this.formConfig.fields[0].fieldGroup[10].hide=!0,this.makeFieldsNotTouchable([0,1,2]),this.disableMaterials(),console.log("event",e),this.WorkOrdrEditID=e,this.http.get("production/work_order/"+e).subscribe(t=>{t&&(this.formConfig.model=t.data,this.formConfig.model.work_order.completed_qty=0,this.formConfig.showActionBtn=!0,this.formConfig.pkId="work_order_id",this.formConfig.submit.label="Update",this.formConfig.model.work_order_id=this.WorkOrdrEditID,this.showForm=!0)}),this.hide()}showWorkorderListFn(){this.showWorkorderList=!0,this.WorkOrderListComponent?.refreshTable()}populateFormWithData(e){if(e.productDetails&&e.productDetails.length>0){this.formConfig.model.bom=e.productDetails.map(o=>({product_id:o.product_id,quantity_required:o.quantity||0}));const t=e.productDetails[0];this.formConfig.model.work_order.product_id=t.product_id||null,this.formConfig.model.work_order.quantity=t.quantity||0}e.saleOrderDetails&&(this.formConfig.model.work_order={...this.formConfig.model.work_order,sale_order_id:e.saleOrderDetails.sale_order_id||null,product_id:e.saleOrderDetails.product?.product_id||e.saleOrderDetails.product_id||this.formConfig.model.work_order.product_id,quantity:e.saleOrderDetails.quantity||this.formConfig.model.work_order.quantity,start_date:e.saleOrderDetails.order_date||null,end_date:e.saleOrderDetails.delivery_date||null})}submitWorkOrder(){const e={...this.formConfig.model,sale_order_id:this.formConfig.model.work_order.sale_order_id};this.http.post("production/work_order/",e).subscribe(t=>{})}populateBom(e){this.http.get(`production/bom/?product_id=${e}`).subscribe(i=>{let l=null;i.data[0]?(l=i.data[0].bom_id,this.http.get(`production/bom/${l}`).subscribe(a=>{const n={work_order:this.formConfig.model.work_order,bom:a.data.bill_of_material,work_order_machines:this.formConfig.model.work_order_machines,workers:this.formConfig.model.workers,work_order_stages:this.formConfig.model.work_order_stages};this.showCreateBomButton=!1,this.formConfig.model=n})):(this.formConfig.model={work_order:this.formConfig.model.work_order,bom:[{}],work_order_machines:this.formConfig.model.work_order_machines,workers:this.formConfig.model.workers,work_order_stages:this.formConfig.model.work_order_stages},this.isBomButtonDisabled=!1,this.showCreateBomButton=!!this.formConfig.model.work_order.product_id)})}createBom(){const t={bom:{bom_name:"Created from Work Order",notes:`This BOM Created from WorkOrder on ${(0,b.p6)(new Date,"dd-MM-yyyy HH:mm","en-US")}`,product_id:this.formConfig.model.work_order.product_id},bill_of_material:this.formConfig.model.bom};this.http.post("production/bom/",t).subscribe({next:o=>{this.showCreateBomButton=!0,this.isBomButtonDisabled=!0,alert("BOM created successfully!")},error:o=>{console.error("Error creating BOM:",o),this.showCreateBomButton=!0,this.isBomButtonDisabled=!1,alert("Error creating BOM. Main Product and Bill of material should be selected.")}})}updateInventory(){const e=this.formConfig.model.work_order;e.work_order_id=this.WorkOrdrEditID,this.http.put(`production/work_orders_get/${this.WorkOrdrEditID}/`,e||{}).subscribe({next:s=>{alert("Inventory Updated successfully!")},error:s=>{console.error("Error Updating the Inventory:",s),alert("Error Updating the Inventory.")}});const t=this.formConfig.model.work_order.product_id,o=this.formConfig.model.work_order.color_id||null,i=this.formConfig.model.work_order.size_id||null,l=this.formConfig.model.work_order.completed_qty,a=`products/products_get/${t}/`;this.http.get(a).subscribe(s=>{if(s){const c=s.balance,d=parseInt(c,10)+parseInt(l,10);console.log("Total product bal :",d);const m={balance:d};console.log({"old balance":c,"new bal":d}),this.http.patch(a,m).subscribe({next:p=>{console.log("response :",p),alert("Product Balance Updated successfully!")},error:p=>{console.error("Error Fetching Products:",p),alert("Error Fetching Products.")}})}});let n=`products/product_variations/?product_id=${t}&color_id=${o}&size_id=${i}`;this.http.get(n).subscribe(s=>{if(s&&Array.isArray(s.data)&&1==s.data.length){const c=s.data[0].product_variation_id,m={quantity:parseInt(s.data[0].quantity||0,10)+parseInt(l,10)};console.log("var-url : ",n),this.http.patch(`products/product_variations/${c}/`,m).subscribe({next:p=>{alert("Product Variation Balance Updated successfully!"),console.log("Variation updated : ",p)},error:p=>{console.error("Error Fetching Product Variation:",p),alert("Error Fetching Product Variation.")}})}else console.log("NO variations . it is Direct Product ***")})}fetchSizeOptions(e,t,o){this.http.get(`products/product_variations/?product_id=${e}`).subscribe(l=>{if(l&&l.data&&Array.isArray(l.data)){const a=l.data.map(s=>({value:{size_id:s.size?.size_id||null,size_name:s.size?.size_name||"----"},label:s.size?.size_name||"----"})),n=t.parent.fieldGroup.find(s=>"size"===s.key);if(n){if(n.templateOptions.options=a.filter((s,c,d)=>c===d.findIndex(m=>m.value.size_id===s.value.size_id)),o){const s=n.templateOptions.options.find(c=>c.value.size_id===o.size_id);s&&n.formControl.setValue(s.value.size_id)}n.formControl.updateValueAndValidity()}}else console.error("Invalid or empty data in size options response:",l)},l=>{console.error("Error fetching size options:",l)})}fetchColorOptions(e,t,o,i){let l=`products/product_variations/?product_id=${t}&size_id=${e}`;e||(l=`products/product_variations/?product_id=${t}&size_isnull=True`),this.http.get(l).subscribe(a=>{if(a&&a.data&&Array.isArray(a.data)){const n=a.data.map(c=>({value:{color_id:c.color?.color_id||null,color_name:c.color?.color_name||"----"},label:c.color?.color_name||"----"})),s=o.parent.fieldGroup.find(c=>"color"===c.key);if(s){if(s.templateOptions.options=n.filter((c,d,m)=>d===m.findIndex(p=>p.value.color_id===c.value.color_id)),i){const c=s.templateOptions.options.find(d=>d.value.color_id===i);c&&s.formControl.setValue(c.value)}s.formControl.updateValueAndValidity()}}else console.error("Invalid or empty data in color options response:",a)},a=>{console.error("Error fetching color options:",a)})}clearColor(e){const t=e.parent.fieldGroup.find(o=>"color"===o.key);t.formControl.setValue(null),t.templateOptions.options=[],t.templateOptions.required=!1}clearSize(e){const t=e.parent.fieldGroup.find(o=>"size"===o.key);t.formControl.setValue(null),t.templateOptions.options=[],t.templateOptions.required=!1}disableMaterials(){if(this.editMode){const e=this.el.nativeElement.querySelectorAll(".ant-card-body");if(e.length>1){const t=e[0];this.renderer.setStyle(t,"pointer-events","none"),this.renderer.setAttribute(t,"aria-disabled","true"),this.renderer.setStyle(t,"user-select","none"),t.querySelectorAll("input, button, select, textarea, a, .ant-select, .ant-dropdown").forEach(i=>{this.renderer.setAttribute(i,"disabled","true")})}}}loadProductVariations(e,t=!1){const o=e.parent,i=e.formControl.value;if(i?.product_id){const l=o.fieldGroup.find(n=>"size"===n.key),a=o.fieldGroup.find(n=>"color"===n.key);t&&(l.formControl.setValue(null),a.formControl.setValue(null)),l&&(l.templateOptions.options=[]),a&&(a.templateOptions.options=[]),this.http.get(`products/product_variations/?product_id=${i.product_id}`).subscribe(n=>{if(n.data.length>0){let s,c;n.data&&n.data.length>0?(s=n.data.map(d=>({label:d.size?.size_name||"----",value:{size_id:d.size?.size_id||null,size_name:d.size?.size_name||"----"}})),c=n.data.map(d=>({label:d.color?.color_name||"----",value:{color_id:d.color?.color_id||null,color_name:d.color?.color_name||"----"}})),l&&(l.formControl.enable(),l.templateOptions.options=s.filter((d,m,p)=>m===p.findIndex(h=>h.value.size_id===d.value.size_id)))):(l&&(l.templateOptions.options=[]),a&&(a.templateOptions.options=[]))}})}else console.info("Product not selected or invalid.")}setFormConfig(){this.WorkOrdrEditID=null,this.formConfig={url:"production/work_order/",formState:{viewMode:!1},showActionBtn:!0,exParams:[],submit:{label:"Submit",submittedFn:()=>this.ngOnInit()},reset:{resetFn:()=>{this.ngOnInit()}},model:{work_order:{},bom:[{}],work_order_machines:[{}],workers:[{}],work_order_stages:[{}]},fields:[{fieldGroupClassName:"ant-row custom-form-block px-0 mx-0",key:"work_order",fieldGroup:[{key:"product_id",type:"select",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"Product",placeholder:"Select Product",dataKey:"product_id",dataLabel:"name",required:!0,bindId:!0,lazy:{url:"products/products/",lazyOneTime:!0}},hooks:{onInit:e=>{e.formControl.valueChanges.subscribe(t=>{this.editMode||this.populateBom(t),this.formConfig&&this.formConfig.model&&this.formConfig.model.work_order?(this.formConfig.model.work_order.product_id=t,t&&this.fetchSizeOptions(t,e,this.formConfig.model.work_order.size_id)):console.error("Form config or work_order data model is not defined.")})}}},{key:"size",type:"select",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"Size",dataKey:"size_id",dataLabel:"size_name",options:[],required:!1},hooks:{onInit:e=>{let t=null;const o=this.formConfig.model.work_order?.size_id;if(o){const i=e,l=i.templateOptions.options.find(a=>a.value.size_id===o);l&&i.formControl.setValue(l.value.size_id)}e.formControl.valueChanges.subscribe(i=>{if(this.formConfig&&this.formConfig.model&&this.formConfig.model.work_order){this.formConfig.model.work_order.size_id=i?.size_id;const l=this.formConfig.model.work_order.color_id,a=this.formConfig.model.work_order.product_id;i?.size_id?this.fetchColorOptions(i?.size_id,a,e,l):(this.fetchColorOptions(null,a,e,l),this.clearColor(e)),i!==t&&(this.clearColor(e),t=i?.size_id)}else console.error("Form config or size_id data model is not defined.")})}}},{key:"color",type:"select",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"Color",dataKey:"color_id",dataLabel:"color_name",options:[],required:!1,lazy:{lazyOneTime:!0}},hooks:{onInit:e=>{const t=this.formConfig.model.work_order?.color_id;e.templateOptions.optionsChange=()=>{if(t){const o=e.templateOptions.options.find(i=>i.value.color_id===t);o&&e.formControl.setValue(o.value.color_id)}},e.formControl.valueChanges.subscribe(o=>{this.formConfig&&this.formConfig.model&&this.formConfig.model.work_order?this.formConfig.model.work_order.color_id=o?.color_id:console.error("Form config or color_id data model is not defined.")})}}},{key:"quantity",type:"input",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"Quantity",required:!0,placeholder:"Enter Quantity"}},{key:"completed_qty",type:"input",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"Completed Quantity",required:!1,placeholder:"Enter Completed Quantity"},expressionProperties:{"templateOptions.disabled":e=>0===e?.pending_qty}},{key:"pending_qty",type:"input",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"Pending Quantity",required:!1,readonly:!0,placeholder:"Pending Quantity"}},{key:"status_id",type:"select",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"Status",placeholder:"Select Status",dataKey:"status_id",dataLabel:"status_name",bindId:!0,lazy:{url:"production/production_statuses/",lazyOneTime:!0}}},{key:"start_date",type:"date",className:"col-md-4 col-sm-6 col-12",defaultValue:(new Date).toISOString().split("T")[0],templateOptions:{type:"date",label:"Start date",required:!1,readonly:!0}},{key:"end_date",type:"date",className:"col-md-4 col-sm-6 col-12",templateOptions:{type:"date",label:"End date",required:!1}},{key:"sync_qty",type:"checkbox",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"Sync QTY",required:!1}},{key:"selectionType",type:"radio",className:"col-md-4 col-sm-6 col-12",defaultValue:"no",templateOptions:{label:"Creating for Sale Order ?",options:[{label:"Yes",value:"yes"},{label:"No",value:"no"}],required:!0}},{key:"sale_order",type:"select",className:"col-md-4 col-sm-6 col-12",hideExpression:e=>"yes"!==e.selectionType,templateOptions:{label:"Order No",dataKey:"sale_order_id",dataLabel:"order_no",options:[],lazy:{url:"sales/sale_order/",lazyOneTime:!0},required:!0},hooks:{onChanges:e=>{e.formControl.valueChanges.subscribe(t=>{e.formControl.value&&this.editMode&&(e.model.selectionType="yes"),this.formConfig&&this.formConfig.model&&this.formConfig.model.work_order?this.formConfig.model.work_order.sale_order_id=t?.sale_order_id:console.error("Form config or sale_order_id data model is not defined.")})}}}]},{fieldGroupClassName:"row col-12 m-0 custom-form-card",className:"tab-form-list px-3",type:"tabs",fieldGroup:[{className:"col-12 px-0 pt-3",props:{label:"Bill Of Material"},fieldGroup:[{key:"bom",type:"table",className:"custom-form-list",templateOptions:{addText:"Add Materials",tableCols:[{name:"product_id",label:"Product"},{name:"size_id",label:"Size"},{name:"color_id",label:"Color"},{name:"quantity",label:"Quantity"},{name:"unit_cost",label:"Unit Cost"},{name:"total_cost",label:"Total Cost"},{name:"notes",label:"Notes"}]},fieldArray:{fieldGroup:[{key:"product",type:"select",templateOptions:{label:"Product",dataKey:"product_id",hideLabel:!0,dataLabel:"name",placeholder:"product",options:[],required:!0,lazy:{url:"products/products/?summary=true",lazyOneTime:!0}},hooks:{onInit:e=>{const t=e.parent;if(!t)return void console.error("Parent array is undefined or not accessible");const o=+t.key,i=this.dataToPopulate?.bom?.[o]?.product;i&&e.formControl.setValue(i),this.loadProductVariations(e),e.formControl.valueChanges.subscribe(l=>{this.formConfig.model.bom[o]||(console.error(`Products at index ${o} is not defined. Initializing...`),this.formConfig.model.bom[o]={}),this.formConfig.model.bom[o].product_id=l?.product_id,this.loadProductVariations(e)})}}},{key:"size",type:"select",templateOptions:{label:"Size",dataKey:"size_id",hideLabel:!0,dataLabel:"size_name",placeholder:"size",options:[],required:!1,lazy:{lazyOneTime:!0}},hooks:{onInit:e=>{const t=e.parent;if(!t)return void console.error("Parent array is undefined or not accessible");const o=+t.key,l=this.dataToPopulate?.bom?.[o]?.size;l?.size_id&&e.formControl.setValue(l),e.formControl.valueChanges.subscribe(a=>{const n=this.formConfig.model.bom[o]?.product;if(!n?.product_id)return void console.warn(`Product missing for row ${o}, skipping color fetch.`);const s=a?.size_id||null;this.http.get(s?`products/product_variations/?product_id=${n.product_id}&size_id=${s}`:`products/product_variations/?product_id=${n.product_id}&size_isnull=True`).subscribe(d=>{const m=d.data.map(h=>({label:h.color?.color_name||"----",value:{color_id:h.color?.color_id||null,color_name:h.color?.color_name||"----"}})).filter((h,F,N)=>F===N.findIndex(B=>B.value.color_id===h.value.color_id)),p=t.fieldGroup.find(h=>"color"===h.key);p&&(p.templateOptions.options=m)}),this.formConfig?.model?.bom?this.formConfig.model.bom[o].size_id=a?.size_id:console.error("Form config or model is not defined.")})}}},{key:"color",type:"select",templateOptions:{label:"Color",dataKey:"color_id",hideLabel:!0,dataLabel:"color_name",placeholder:"color",options:[],required:!1,lazy:{lazyOneTime:!0}},hooks:{onInit:e=>{const t=e.parent;if(!t)return void console.error("Parent array is undefined or not accessible");const o=+t.key,l=this.dataToPopulate?.bom?.[o]?.color;l&&e.formControl.setValue(l),e.formControl.valueChanges.subscribe(a=>{const n=this.formConfig.model.bom[o];if(!n?.product?.product_id)return void console.warn(`Product missing for row ${o}, skipping color update.`);const{product:s,size:c,color:d}=n,m=new URLSearchParams({product_id:s.product_id});d?.color_id?m.append("color_id",d.color_id):m.append("color_isnull","True"),c?.size_id?m.append("size_id",c.size_id):m.append("size_isnull","True"),n.color_id=d?.color_id||null})}}},{key:"quantity",type:"input",templateOptions:{label:"Quantity",placeholder:"Enter Quantity",hideLabel:!0,required:!0,type:"number"},hooks:{onInit:e=>{e.formControl.valueChanges.subscribe(t=>{if(e.form&&e.form.controls&&e.form.controls.quantity&&e.form.controls.unit_cost&&t){const o=e.form.controls.quantity.value,i=e.form.controls.unit_cost.value;o&&i&&e.form.controls.total_cost.setValue((parseFloat(o)*parseFloat(i)).toFixed(2))}else e.form.controls.total_cost.setValue(0)})}}},{key:"unit_cost",type:"input",templateOptions:{label:"Unit Cost",placeholder:"Enter Unit Cost",hideLabel:!0,required:!0,type:"number"},hooks:{onInit:e=>{e.formControl.valueChanges.subscribe(t=>{if(e.form&&e.form.controls&&e.form.controls.quantity&&e.form.controls.unit_cost&&t){const o=e.form.controls.quantity.value,i=e.form.controls.unit_cost.value;o&&i&&e.form.controls.total_cost.setValue((parseFloat(o)*parseFloat(i)).toFixed(2))}else e.form.controls.total_cost.setValue(0)})}}},{key:"total_cost",type:"input",templateOptions:{label:"Total Cost",hideLabel:!0,required:!0,disabled:!0}},{key:"notes",type:"text",templateOptions:{label:"Notes",placeholder:"Enter Notes",hideLabel:!0,required:!1}}]}}]},{className:"col-12 px-0 pt-3",props:{label:"Worker"},fieldGroup:[{key:"workers",type:"table",className:"custom-form-list",templateOptions:{addText:"Add Worker",tableCols:[{name:"hours_worked",label:"Hours"},{name:"employee_id",label:"Worker"}]},fieldArray:{fieldGroup:[{key:"employee",type:"select",className:"col",templateOptions:{label:"Worker",dataKey:"employee_id",dataLabel:"first_name",options:[],hideLabel:!0,required:!1,lazy:{url:"hrms/employees/",lazyOneTime:!0}},hooks:{onChanges:e=>{e.formControl.valueChanges.subscribe(t=>{const o=e.parent.key;this.formConfig.model.workers[o]||(console.error(`Machine at index ${o} is not defined. Initializing...`),this.formConfig.model.workers[o]={}),this.formConfig.model.workers[o].employee_id=t.employee_id})}}},{key:"hours_worked",type:"input",className:"col",templateOptions:{label:"Hours Worked",placeholder:"Enter Hours",hideLabel:!0,required:!1}}]}}]},{className:"col-12 px-0 pt-3",props:{label:"Machines"},fieldGroup:[{key:"work_order_machines",type:"table",className:"custom-form-list",templateOptions:{addText:"Add Machine",tableCols:[{name:"machine",label:"Machine"}]},fieldArray:{fieldGroup:[{key:"machine",type:"select",className:"col",templateOptions:{label:"Machine",dataKey:"machine_id",dataLabel:"machine_name",options:[],hideLabel:!0,required:!1,lazy:{url:"production/machines/",lazyOneTime:!0}},hooks:{onChanges:e=>{e.formControl.valueChanges.subscribe(t=>{const o=e.parent.key;this.formConfig.model.work_order_machines[o]||(console.error(`Machine at index ${o} is not defined. Initializing...`),this.formConfig.model.work_order_machines[o]={}),this.formConfig.model.work_order_machines[o].machine_id=t.machine_id})}}}]}}]},{className:"col-12 px-0 pt-3",props:{label:"Work Stage"},fieldGroup:[{key:"work_order_stages",type:"table",className:"custom-form-list",templateOptions:{addText:"Add Work Level",tableCols:[{name:"hours_worked",label:"Hours"},{name:"employee_id",label:"Worker"}]},fieldArray:{fieldGroup:[{key:"stage_name",type:"input",templateOptions:{label:"Stage Name",placeholder:"Enter Stage Name",hideLabel:!0,required:!1}},{key:"stage_description",type:"input",templateOptions:{label:"Description",placeholder:"Enter Description",hideLabel:!0,required:!1}},{key:"stage_start_date",type:"date",templateOptions:{label:"Stage Start Date",placeholder:"Enter Start Date",hideLabel:!0,required:!1}},{key:"stage_end_date",type:"date",templateOptions:{label:"Stage End Date",placeholder:"Enter End Date",hideLabel:!0,required:!1}},{key:"notes",type:"textarea",templateOptions:{label:"Notes",placeholder:"Enter Notes",hideLabel:!0,required:!1}}]}}]}]}]}}}return u.\u0275fac=function(e){return new(e||u)(r.Y36(C.eN),r.Y36(r.SBq),r.Y36(r.Qsj))},u.\u0275cmp=r.Xpm({type:u,selectors:[["app-production"]],viewQuery:function(e,t){if(1&e&&r.Gf(w,5),2&e){let o;r.iGM(o=r.CRH())&&(t.WorkOrderListComponent=o.first)}},standalone:!0,features:[r.jDz],decls:23,vars:5,consts:[[1,"container-fluid","p-3"],[1,"workorder-banner"],[1,"col-12","px-0",2,"display","flex","justify-content","space-between","align-items","center","flex-wrap","wrap"],["type","button",1,"btn","pl-0",2,"color","black",3,"click"],["class","custom-heading",4,"ngIf"],[2,"display","flex","gap","10px"],["type","button","data-bs-toggle","modal","data-bs-target","#productionModal",1,"btn","btn-primary",3,"click"],["type","button","class","btn btn-danger ms-auto blink-twice","data-bs-toggle","modal","data-bs-target","#bomModal",3,"disabled","click",4,"ngIf"],[1,"row","custom-form"],["class","col-12 px-1",4,"ngIf"],["id","productionModal","tabindex","-1","aria-labelledby","productionModalLabel","aria-hidden","true",1,"modal","fade","custom-modal"],[1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header"],["id","productModalLabel",1,"modal-title"],["type","button","id","modalClose","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],["class","modal-body",4,"ngIf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-danger"],[1,"custom-heading"],["type","button","data-bs-toggle","modal","data-bs-target","#bomModal",1,"btn","btn-danger","ms-auto","blink-twice",3,"disabled","click"],[1,"col-12","px-1"],[3,"options"],[1,"modal-body"],[1,"custom-list",3,"edit"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),r.NdJ("click",function(){return t.WorkOrdrEditID=null}),r.YNc(4,v,2,0,"span",4),r.YNc(5,q,2,0,"span",4),r.qZA(),r.TgZ(6,"div",5)(7,"button",6),r.NdJ("click",function(){return t.showWorkorderListFn()}),r._uU(8,"Work Order List "),r.qZA(),r.YNc(9,T,2,1,"button",7),r.qZA()()(),r.TgZ(10,"div",8),r.YNc(11,x,2,1,"div",9),r.qZA()(),r.TgZ(12,"div",10)(13,"div",11)(14,"div",12)(15,"div",13)(16,"h5",14),r._uU(17,"Edit Work Order List"),r.qZA(),r._UZ(18,"button",15),r.qZA(),r.YNc(19,I,2,0,"div",16),r.TgZ(20,"div",17)(21,"button",18),r._uU(22,"Close"),r.qZA()()()()()),2&e&&(r.xp6(4),r.Q6J("ngIf",t.WorkOrdrEditID),r.xp6(1),r.Q6J("ngIf",!t.WorkOrdrEditID),r.xp6(4),r.Q6J("ngIf",t.showCreateBomButton),r.xp6(2),r.Q6J("ngIf",t.WorkOrdrEditID||t.showForm),r.xp6(8),r.Q6J("ngIf",t.showWorkorderList))},dependencies:[b.ez,b.O5,g.l,z.C,w],styles:["@keyframes _ngcontent-%COMP%_blink{0%,to{opacity:1}50%{opacity:0}}.blink-twice[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_blink .5s ease-in-out 3}"]}),u})()}}]);