"use strict";(self.webpackChunkcnl=self.webpackChunkcnl||[]).push([[225],{5972:(y,_,c)=>{c.r(_),c.d(_,{RolesComponent:()=>v});var m=c(6814),p=c(3929),e=c(5879),u=c(9862),r=c(6223),g=c(5581);function f(s,d){if(1&s){const t=e.EpF();e.TgZ(0,"div",22)(1,"input",19),e.NdJ("ngModelChange",function(i){const n=e.CHM(t).$implicit;return e.KtG(n.selected=i)})("change",function(){const l=e.CHM(t).$implicit,n=e.oxw().$implicit,a=e.oxw().$implicit,b=e.oxw();return e.KtG(b.toggleAction(a,n,l,l.selected))}),e.qZA(),e._uU(2),e.qZA()}if(2&s){const t=d.$implicit;e.xp6(1),e.Q6J("ngModel",t.selected),e.xp6(1),e.hij(" ",t.action_name," ")}}function h(s,d){if(1&s){const t=e.EpF();e.TgZ(0,"div",22)(1,"div")(2,"input",19),e.NdJ("ngModelChange",function(i){const n=e.CHM(t).$implicit;return e.KtG(n.selected=i)})("change",function(){const l=e.CHM(t).$implicit,n=e.oxw().$implicit,a=e.oxw();return e.KtG(a.toggleSection(n,l,l.selected))}),e.qZA(),e._uU(3),e.qZA(),e.YNc(4,f,3,2,"div",21),e.qZA()}if(2&s){const t=d.$implicit;e.xp6(2),e.Q6J("ngModel",t.selected),e.xp6(1),e.hij(" ",t.section_name," "),e.xp6(1),e.Q6J("ngForOf",t.actions)}}function C(s,d){if(1&s){const t=e.EpF();e.TgZ(0,"div",17)(1,"div",18)(2,"div")(3,"input",19),e.NdJ("ngModelChange",function(i){const n=e.CHM(t).$implicit;return e.KtG(n.selected=i)})("change",function(){const l=e.CHM(t).$implicit,n=e.oxw();return e.KtG(n.toggleModule(l,l.selected))}),e.qZA(),e.TgZ(4,"span",20),e._uU(5),e.qZA()(),e.YNc(6,h,5,3,"div",21),e.qZA()()}if(2&s){const t=d.$implicit;e.xp6(3),e.Q6J("ngModel",t.selected),e.xp6(2),e.Oqu(t.module_name),e.xp6(1),e.Q6J("ngForOf",t.module_sections)}}let v=(()=>{class s{constructor(t){this.http=t,this.curdConfig={drawerSize:500,drawerPlacement:"top",tableConfig:{apiUrl:"users/role/",title:"User Roles",pkId:"role_id",pageSize:10,globalSearch:{keys:["role_name","description"]},cols:[{fieldKey:"role_name",name:"Name",sort:!0},{fieldKey:"description",name:"Description",sort:!0},{fieldKey:"code",name:"Action",type:"action",actions:[{type:"delete",label:"Delete",confirm:!0,confirmMsg:"Sure to delete?",apiUrl:"users/role"},{type:"edit",label:"Edit"},{type:"callBackFn",callBackFn:(o,i)=>{console.log(o),this.selectedRow=o,this.showConfig()},icon:"fas fa-cog fa-fw"}]}]},formConfig:{url:"users/role/",title:"User Role",pkId:"role_id",exParams:[],fields:[{fieldGroupClassName:"row col-12 p-0 m-0 custom-form field-no-bottom-space",fieldGroup:[{key:"role_name",type:"input",className:"col-md-6 col-12",templateOptions:{label:"Role Nmae",placeholder:"Enter Role Name",required:!0}},{key:"description",type:"textarea",className:"col-md-6 col-12",templateOptions:{label:"Description",placeholder:"Enter description",required:!0}}]}]}},this.tableConfig={apiUrl:"users/role/",title:"Roles",pkId:"role_id",pageSize:10,globalSearch:{keys:["id","first_name","last_name"]},cols:[{fieldKey:"",name:"Name"},{fieldKey:"description",name:"Description",sort:!0},{fieldKey:"created_at",name:"Created TS",sort:!0},{fieldKey:"code",name:"Action",type:"action",actions:[{type:"delete",label:"Delete",confirm:!0,confirmMsg:"Sure to delete?",apiUrl:"api/users"},{type:"callBackFn",label:"Edit"}]}]},this.moduleList=[]}ngOnInit(){this.http.get("users/actions/").subscribe(t=>{this.actionList=t.data,this.http.get("users/modules/?sections=true").subscribe(o=>{this.moduleList=o.data.map(i=>(i.module_sections=i.module_sections.map(l=>(l.actions=JSON.parse(JSON.stringify(this.actionList)),l)),i)),console.log("this.moduleList",this.moduleList)})})}showConfig(){this.http.get("users/role_permissions/"+this.selectedRow?.role_id).subscribe(o=>{console.log("get config",o.data),this.setConfig(o.data)}),new bootstrap.Modal(document.getElementById("exampleModal"),{}).show()}setConfig(t){this.moduleList.forEach(o=>{t.forEach(i=>{o.module_id==i.module_id&&o.module_sections.forEach(l=>{l.section_id==i.section_id&&l.actions.forEach(n=>{n.action_id==i.action_id&&(n.selected=!0),l.actions.every(a=>1==a.selected)&&(l.selected=!0),o.module_sections.every(a=>1==a.selected)&&(o.selected=!0)})})})})}toggleAll(t,o){t.forEach(i=>i.selected=o)}toggleSection(t,o,i){o.selected=i,this.toggleAll(o.actions,i),t.selected=t.module_sections.every(l=>l.selected)}toggleModule(t,o){t.selected=o,t.module_sections.forEach(i=>{i.selected=o,this.toggleAll(i.actions,o)})}toggleAction(t,o,i,l){i.selected=l,o.selected=o.actions.every(n=>n.selected),t.selected=t.module_sections.every(n=>n.selected)}saveActions(){let t=[];this.moduleList.forEach(o=>{o.module_sections.forEach(i=>{i.actions.forEach(l=>{l.selected&&t.push({module_id:o.module_id,section_id:i.section_id,action_id:l.action_id,role_id:this.selectedRow.role_id})})})}),console.log("this.selectedList",t),this.http.post("users/role_permissions/",t).subscribe(o=>{console.log(o),document.getElementById("modalClose").click()})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(u.eN))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-roles"]],standalone:!0,features:[e.jDz],decls:22,vars:3,consts:[[1,"container-fluid","pt-3"],[1,"row"],[1,"col-12","px-1"],[1,"custom-list",3,"options"],["id","exampleModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade","custom-modal"],[1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title"],["type","button","id","modalClose","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"container-fluid","mt-2","p-0"],[1,"row","m-0",2,"height","calc(100vh - 220px)","overflow-y","auto","overflow-x","hidden"],["class","col-lg-3 col-md-4 col-sm-6 col-12 p-1",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"col-lg-3","col-md-4","col-sm-6","col-12","p-1"],[1,"border","p-3","h-100"],["type","checkbox",3,"ngModel","ngModelChange","change"],[1,"ms-1",2,"font-weight","bold"],["style","margin-left: 20px;",4,"ngFor","ngForOf"],[2,"margin-left","20px"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"ta-curd-modal",3),e.qZA()()(),e.TgZ(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7)(8,"h5",8),e._uU(9,"Role Config"),e.qZA(),e.TgZ(10,"button",9),e.NdJ("click",function(){return o.ngOnInit()}),e.qZA()(),e.TgZ(11,"div",10)(12,"div",11)(13,"h2"),e._uU(14),e.qZA(),e.TgZ(15,"div",12),e.YNc(16,C,7,3,"div",13),e.qZA()()(),e.TgZ(17,"div",14)(18,"button",15),e.NdJ("click",function(){return o.ngOnInit()}),e._uU(19,"Close"),e.qZA(),e.TgZ(20,"button",16),e.NdJ("click",function(){return o.saveActions()}),e._uU(21,"Save changes"),e.qZA()()()()()),2&t&&(e.xp6(3),e.Q6J("options",o.curdConfig),e.xp6(11),e.Oqu(null==o.selectedRow?null:o.selectedRow.role_name),e.xp6(2),e.Q6J("ngForOf",o.moduleList))},dependencies:[m.ez,m.sg,p.l,r.Wl,r.JJ,r.On,g.h],styles:["h2[_ngcontent-%COMP%]{font-size:20px}"]}),s})()}}]);