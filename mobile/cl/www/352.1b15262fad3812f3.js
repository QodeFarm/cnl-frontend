"use strict";(self.webpackChunkcnl=self.webpackChunkcnl||[]).push([[352],{9352:(C,i,s)=>{s.r(i),s.d(i,{SalesDispatchComponent:()=>h});var r=s(6814),l=s(3929),t=s(5879),d=s(9862),p=s(5581);function _(n,a){if(1&n&&(t.TgZ(0,"div",9),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.AsE(" ",e.product_name," (Qty: ",e.quantity,") ")}}function u(n,a){if(1&n&&(t.ynx(0),t.YNc(1,_,2,2,"div",8),t.BQk()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngForOf",e.products)}}function m(n,a){1&n&&t._uU(0,"No products available")}function g(n,a){if(1&n&&(t.YNc(0,u,2,1,"ng-container",6),t.YNc(1,m,1,0,"ng-template",null,7,t.W1O)),2&n){const e=a.$implicit,o=t.MAs(2);t.Q6J("ngIf",e.products&&e.products.length>0)("ngIfElse",o)}}function f(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",10)(1,"div",11)(2,"h5"),t._uU(3,"Confirm Dispatch"),t.qZA(),t.TgZ(4,"p"),t._uU(5),t.qZA(),t.TgZ(6,"div",12)(7,"button",13),t.NdJ("click",function(){t.CHM(e);const c=t.oxw();return t.KtG(c.closeModal())}),t._uU(8,"Cancel"),t.qZA(),t.TgZ(9,"button",14),t.NdJ("click",function(){t.CHM(e);const c=t.oxw();return t.KtG(c.confirmDispatch())}),t._uU(10,"Confirm"),t.qZA()()()()}if(2&n){const e=t.oxw();t.xp6(5),t.hij("Are you sure you want to confirm dispatch for the order ",null==e.selectedOrder?null:e.selectedOrder.order_no,"?")}}let h=(()=>{class n{constructor(e){this.http=e,this.isLoading=!0,this.showModal=!1,this.selectedOrder=null,this.curdConfig=this.getCurdConfig()}ngOnInit(){this.isLoading=!0,this.getCurdConfig()}getCurdConfig(){return{drawerSize:500,drawerPlacement:"right",hideAddBtn:!0,tableConfig:{apiUrl:"sales/sale_order/?summary=true&flow_status=dispatch",title:"Sales Dispatch",pkId:"sale_order_id",pageSize:10,globalSearch:{keys:["customer","order_no","products"]},defaultSort:{key:"created_at",value:"descend"},cols:[{fieldKey:"customer",name:"Customer",displayType:"map",mapFn:(e,o)=>`${o.customer.name}`,sort:!0},{fieldKey:"order_no",name:"Order No",sort:!0},{fieldKey:"products",name:"Products",displayType:"map",mapFn:(e,o)=>o.products&&"object"==typeof o.products?Object.values(o.products).map(c=>`${c.product_name} (Qty: ${c.quantity})`).join(", "):"No products"},{fieldKey:"actions",name:"Actions",type:"action",actions:[{type:"callBackFn",label:"Confirm Dispatch",callBackFn:e=>this.openModal(e)}]}]},formConfig:{url:"sales/SaleOrder/{saleOrderId}/move_next_stage/"}}}openModal(e){this.selectedOrder=e,this.showModal=!0}closeModal(){this.showModal=!1,this.selectedOrder=null}confirmDispatch(){if(this.selectedOrder){const e=this.selectedOrder.sale_order_id;this.http.post(`sales/SaleOrder/${e}/move_next_stage/`,{}).subscribe(()=>{console.log("Dispatch confirmed for order:",e),this.closeModal(),this.refreshCurdConfig()},c=>{console.error("Error in confirming dispatch:",c),alert("Failed to confirm dispatch. Please try again.")})}this.ngOnInit()}refreshCurdConfig(){this.curdConfig=this.getCurdConfig()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(d.eN))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-sales-dispatch"]],standalone:!0,features:[t.jDz],decls:7,vars:3,consts:[[1,"container-fluid","pt-3"],[1,"row"],[1,"col-12","px-2","py-1"],[1,"custom-list",3,"options","customProductTemplate"],["customProductTemplate",""],["class","custom-dialog-overlay",4,"ngIf"],[4,"ngIf","ngIfElse"],["noProducts",""],["style","display: flex; align-items: center;",4,"ngFor","ngForOf"],[2,"display","flex","align-items","center"],[1,"custom-dialog-overlay"],[1,"custom-dialog-box"],[1,"dialog-actions"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-primary",3,"click"]],template:function(e,o){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._UZ(3,"ta-curd-modal",3),t.qZA()()(),t.YNc(4,g,3,2,"ng-template",null,4,t.W1O),t.YNc(6,f,11,1,"div",5)),2&e){const c=t.MAs(5);t.xp6(3),t.Q6J("options",o.curdConfig)("customProductTemplate",c),t.xp6(3),t.Q6J("ngIf",o.showModal)}},dependencies:[r.ez,r.sg,r.O5,l.l,p.h],styles:[".custom-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.custom-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .custom-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #ddd;padding:8px;text-align:left}.custom-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#170564;color:#fff;font-weight:400;text-align:left}.custom-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#fff}.custom-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(even){background-color:#f2f2f2}.custom-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#fff}.table-header[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{color:#fff}.custom-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{word-wrap:break-word}.custom-dialog-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.5);z-index:1000}.custom-dialog-box[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background-color:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 10px #0000001a;text-align:center;min-width:300px;max-width:90%}.dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:20px;margin-top:15px}button[_ngcontent-%COMP%]{min-width:80px;padding:8px 16px;font-size:14px}"]}),n})()}}]);