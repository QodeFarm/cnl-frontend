"use strict";(self.webpackChunkcnl=self.webpackChunkcnl||[]).push([[577],{2577:(w,y,d)=>{d.r(y),d.d(y,{QuickpacksComponent:()=>L});var h=d(6814),C=d(3929),e=d(5879),g=d(7871),v=d(2787);let q=(()=>{class a{refreshTable(){this.taTableComponent?.refresh()}constructor(t){this.router=t,this.edit=new e.vpe,this.tableConfig={apiUrl:"sales/quick_pack/",showCheckbox:!0,pkId:"quick_pack_id",pageSize:10,globalSearch:{keys:["created_at","name","lot_qty","description","active"]},defaultSort:{key:"created_at",value:"descend"},cols:[{fieldKey:"name",name:"Quick Pack Name",sort:!0},{fieldKey:"lot_qty",name:"Lot Quantity",sort:!0},{fieldKey:"description",name:"Description",sort:!0},{fieldKey:"active",name:"Active",sort:!0},{fieldKey:"code",name:"Action",type:"action",actions:[{type:"delete",label:"Delete",apiUrl:"sales/quick_pack"},{type:"callBackFn",icon:"fa fa-pen",label:"",callBackFn:(o,i)=>{console.log(o),this.edit.emit(o.quick_pack_id)}}]}]}}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(v.F0))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-quickpacks-list"]],viewQuery:function(t,o){if(1&t&&e.Gf(g.Z,5),2&t){let i;e.iGM(i=e.CRH())&&(o.taTableComponent=i.first)}},outputs:{edit:"edit"},standalone:!0,features:[e.jDz],decls:1,vars:1,consts:[[1,"custom-list",3,"options"]],template:function(t,o){1&t&&e._UZ(0,"ta-table",0),2&t&&e.Q6J("options",o.tableConfig)},dependencies:[h.ez,C.l,g.Z]}),a})();var z=d(9862),Q=d(7127);function P(a,r){1&a&&(e.TgZ(0,"span",17),e._uU(1,"Update Quick Pack"),e.qZA())}function I(a,r){1&a&&(e.TgZ(0,"span",17),e._uU(1,"Create Quick Pack"),e.qZA())}function T(a,r){if(1&a&&(e.TgZ(0,"div",18),e._UZ(1,"ta-form",19),e.qZA()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("options",t.formConfig)}}function x(a,r){if(1&a){const t=e.EpF();e.TgZ(0,"div",20)(1,"app-quickpacks-list",21),e.NdJ("edit",function(i){e.CHM(t);const k=e.oxw();return e.KtG(k.editQuickPack(i))}),e.qZA()()}}let L=(()=>{class a{constructor(t){this.http=t,this.showQuickPackList=!1,this.showForm=!1,this.unitOptionOfProduct=[],this.formConfig={}}ngOnInit(){this.showQuickPackList=!1,this.showForm=!0,this.quickPackID=null,this.setFormConfig(),console.log("this.formConfig",this.formConfig)}hide(){document.getElementById("modalClose")?.click()}editQuickPack(t){console.log("event",t),this.quickPackID=t,this.http.get("sales/quick_pack/"+t).subscribe(o=>{console.log("--------\x3e res ",o),o&&o.data&&(this.formConfig.model=o.data,this.formConfig.showActionBtn=!0,this.formConfig.submit.label="Update",this.formConfig.pkId="quick_pack_id",this.formConfig.model.quick_pack_id=this.quickPackID,this.showForm=!0)}),this.hide()}showQuickPackListFn(){this.showQuickPackList=!0,this.QuickpacksListComponent?.refreshTable()}setFormConfig(){this.quickPackID=null,this.formConfig={url:"sales/quick_pack/",title:"",formState:{viewMode:!1},showActionBtn:!0,exParams:[{key:"quick_pack_data_items",type:"script",value:"data.quick_pack_data_items.map(m => {m.product_id = m.product.product_id; return m;})"},{key:"quick_pack_data_items",type:"script",value:"data.quick_pack_data_items.map(m=> {m.size_id = m.size?.size_id || null;  return m ;})"},{key:"quick_pack_data_items",type:"script",value:"data.quick_pack_data_items.map(m=> {m.color_id = m.color?.color_id || null;  return m ;})"}],submit:{label:"Submit",submittedFn:()=>this.ngOnInit()},reset:{resetFn:()=>{this.ngOnInit()}},model:{quick_pack_data:{},quick_pack_data_items:[{}]},fields:[{fieldGroupClassName:"ant-row custom-form-block px-0 mx-0",key:"quick_pack_data",fieldGroup:[{key:"name",type:"input",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"Quick Pack Name",placeholder:"Enter Quick Pack Name",required:!0}},{key:"lot_qty",type:"input",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"Lot Quantity",placeholder:"Enter Lot Quantity",required:!0}},{key:"active",type:"select",className:"col-md-4 col-sm-6 col-12",defaultValue:"Y",templateOptions:{label:"Active",options:[{label:"Yes",value:"Y"},{label:"No",value:"N"}],required:!1}},{key:"description",type:"textarea",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"Description",placeholder:"Enter Description",required:!1}}]},{key:"quick_pack_data_items",type:"repeat",className:"custom-form-list",templateOptions:{title:"Products",addText:"Add Product",tableCols:[{name:"product",label:"Product"},{name:"size",label:"Size"},{name:"color",label:"Color"},{name:"quantity",label:"Quantity"}]},fieldArray:{fieldGroup:[{key:"product",type:"select",templateOptions:{label:"Select Product",dataKey:"product_id",hideLabel:!0,dataLabel:"name",options:[],required:!0,lazy:{url:"products/products/?summary=true",lazyOneTime:!0}},hooks:{onInit:t=>{const o=t.parent;if(o){const i=+o.key;t.formControl.valueChanges.subscribe(k=>{const n=this.formConfig.model.quick_pack_data_items[i]?.product;console.log("Product id : ",n),n?.product_id?this.http.get(`products/product_variations/?product_id=${n.product_id}`).subscribe(c=>{if(c.data.length>0){const l=o.fieldGroup.find(s=>"size"===s.key),p=o.fieldGroup.find(s=>"color"===s.key);let f,m;l&&(l.templateOptions.options=[]),p&&(p.templateOptions.options=[]),c.data&&c.data.length>0?(f=c.data.map(s=>({label:s.size?.size_name||"----",value:{size_id:s.size?.size_id||null,size_name:s.size?.size_name||"----"}})),m=c.data.map(s=>({label:s.color?.color_name||"----",value:{color_id:s.color?.color_id||null,color_name:s.color?.color_name||"----"}})),l&&(l.formControl.enable(),l.templateOptions.options=f.filter((s,_,u)=>_===u.findIndex(b=>b.value.size_id===s.value.size_id)))):(l&&(l.templateOptions.options=[]),p&&(p.templateOptions.options=[]))}else console.log(`For Product: ${n.name}  - No Size and Colors are available setting those to Null**`),this.formConfig.model.quick_pack_data_items[i].size_id=null,this.formConfig.model.quick_pack_data_items[i].color_id=null}):console.error("Product not selected or invalid.")})}else console.error("Parent array is undefined or not accessible")}}},{key:"size",type:"select",templateOptions:{label:"Select Size",dataKey:"size_id",hideLabel:!0,dataLabel:"size_name",options:[],required:!1,lazy:{lazyOneTime:!0}},hooks:{onInit:t=>{const o=t.parent;if(o){const i=+o.key;t.formControl.valueChanges.subscribe(k=>{const n=this.formConfig.model.quick_pack_data_items[i]?.product,c=this.formConfig.model.quick_pack_data_items[i]?.size;if(c){let p=`products/product_variations/?product_id=${n.product_id}&size_id=${c.size_id}`;null==(c?.size_id||null)&&(p=`products/product_variations/?product_id=${n.product_id}&size_isnull=True`),this.http.get(p).subscribe(f=>{const s=f.data.map(u=>({label:u.color?.color_name||"----",value:{color_id:u.color?.color_id||null,color_name:u.color?.color_name||"----"}})).filter((u,b,O)=>b===O.findIndex(Z=>Z.value.color_id===u.value.color_id)),_=o.fieldGroup.find(u=>"color"===u.key);_&&(_.templateOptions.options=[],_.templateOptions.options=s)})}else console.log("Size not selected or invalid.")})}else console.error("Parent array is undefined or not accessible")},onChanges:t=>{t.formControl.valueChanges.subscribe(o=>{this.formConfig&&this.formConfig.model?this.formConfig.model.quick_pack_data_items[t.parent.key].size_id=o?.size_id:console.error("Form config or color model is not defined.")})}}},{key:"color",type:"select",templateOptions:{label:"Select Color",dataKey:"color_id",hideLabel:!0,dataLabel:"color_name",options:[],required:!1,lazy:{lazyOneTime:!0}},hooks:{onInit:t=>{const o=t.parent;if(o){const i=+o.key;t.formControl.valueChanges.subscribe(k=>{const n=this.formConfig.model.quick_pack_data_items[i]?.product,c=this.formConfig.model.quick_pack_data_items[i]?.size,l=this.formConfig.model.quick_pack_data_items[i]?.color;if(n?.product_id&&c&&l){let m=`products/product_variations/?product_id=${n.product_id}`;null===l.color_id?m+="&color_isnull=True":l.color_id&&(m+=`&color_id=${l.color_id}`),null===c.size_id?m+="&size_isnull=True":c.size_id&&(m+=`&size_id=${c.size_id}`),this.formConfig.model.quick_pack_data_items[i].color_id=l.color_id}else console.log(`No valid Color selected for :${n.name} at Row ${i}.`),console.log({product:n?.name,size:c?.size_name,color:l?.color_name,selectedColorId:k}),void 0===l?.color_id&&(this.formConfig.model.quick_pack_data_items[i].color=null)})}},onChanges:t=>{t.formControl.valueChanges.subscribe(o=>{this.formConfig&&this.formConfig.model?this.formConfig.model.quick_pack_data_items[t.parent.key].color_id=o?.color_id:console.error("Form config or color model is not defined.")})}}},{type:"input",key:"quantity",templateOptions:{label:"Quantity",placeholder:"Enter Quantity",hideLabel:!0,required:!0}}]}}]}}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(z.eN))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-quickpacks"]],viewQuery:function(t,o){if(1&t&&e.Gf(q,5),2&t){let i;e.iGM(i=e.CRH())&&(o.QuickpacksListComponent=i.first)}},standalone:!0,features:[e.jDz],decls:21,vars:4,consts:[[1,"container-fluid","p-3"],[1,"quickpacks-banner"],[1,"col-12","px-0",2,"display","flex","justify-content","space-between","align-items","center","flex-wrap","wrap"],["type","button",1,"btn","pl-0",2,"color","black",3,"click"],["class","custom-heading",4,"ngIf"],["type","button","data-bs-toggle","modal","data-bs-target","#quickPackModal",1,"btn","btn-primary",3,"click"],[1,"row","custom-form"],["class","col-12 px-1",4,"ngIf"],["id","quickPackModal","tabindex","-1","aria-labelledby","quickPackModalLabel","aria-hidden","true",1,"modal","fade","custom-modal"],[1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header"],["id","quickPackModalLabel",1,"modal-title"],["type","button","id","modalClose","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],["class","modal-body",4,"ngIf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-danger"],[1,"custom-heading"],[1,"col-12","px-1"],[3,"options"],[1,"modal-body"],[1,"custom-list",3,"edit"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),e.NdJ("click",function(){return o.quickPackID=null}),e.YNc(4,P,2,0,"span",4),e.YNc(5,I,2,0,"span",4),e.qZA(),e.TgZ(6,"button",5),e.NdJ("click",function(){return o.showQuickPackListFn()}),e._uU(7," Quick Pack List "),e.qZA()()(),e.TgZ(8,"div",6),e.YNc(9,T,2,1,"div",7),e.qZA()(),e.TgZ(10,"div",8)(11,"div",9)(12,"div",10)(13,"div",11)(14,"h5",12),e._uU(15,"Edit Quick Pack List"),e.qZA(),e._UZ(16,"button",13),e.qZA(),e.YNc(17,x,2,0,"div",14),e.TgZ(18,"div",15)(19,"button",16),e._uU(20,"Close"),e.qZA()()()()()),2&t&&(e.xp6(4),e.Q6J("ngIf",o.quickPackID),e.xp6(1),e.Q6J("ngIf",!o.quickPackID),e.xp6(4),e.Q6J("ngIf",o.showForm),e.xp6(8),e.Q6J("ngIf",o.showQuickPackList))},dependencies:[h.ez,h.O5,C.l,Q.C,q]}),a})()}}]);