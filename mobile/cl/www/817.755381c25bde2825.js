"use strict";(self.webpackChunkcnl=self.webpackChunkcnl||[]).push([[817],{1602:(g,p,s)=>{s.d(p,{H:()=>h});var u=s(6814),i=s(5879),_=s(3929),e=s(7871),f=s(2787);let h=(()=>{class m{refreshTable(){this.taTableComponent?.refresh()}constructor(l){this.router=l,this.edit=new i.vpe,this.tableConfig={apiUrl:"leads/leads/",showCheckbox:!0,pkId:"lead_id",pageSize:10,globalSearch:{keys:["interaction_date","name","email","phone","lead_status","score","assignee","notes"]},defaultSort:{key:"created_at",value:"descend"},cols:[{fieldKey:"name",name:"Name",sort:!0},{fieldKey:"email",name:"Email",sort:!0},{fieldKey:"phone",name:"Phone",sort:!0},{fieldKey:"lead_status",name:"Lead Status",displayType:"map",mapFn:(d,o,r)=>`${o.lead_status.status_name}`,sort:!0},{fieldKey:"score",name:"Score",sort:!0},{fieldKey:"assignee",name:"Assigned",sort:!0,displayType:"map",mapFn:(d,o,r)=>`${o.assignee?.first_name||""} ${o.assignee?.last_name||""}`.trim()},{fieldKey:"interaction_date",name:"Interaction Date",displayType:"map",mapFn:(d,o,r)=>{const t=o.interaction[0].interaction_date,[a,n]=t.split("T");return`${a}<br>${n}`},sort:!1},{fieldKey:"notes",name:"Notes",displayType:"map",mapFn:(d,o,r)=>(console.log("row",o),`${o.interaction[0].notes}`),sort:!1},{fieldKey:"code",name:"Action",type:"action",actions:[{type:"delete",label:"Delete",confirm:!0,confirmMsg:"Sure to delete?",apiUrl:"leads/leads"},{type:"callBackFn",icon:"fa fa-pen",label:"",callBackFn:(d,o)=>{this.edit.emit(d.lead_id)}}]}]}}}return m.\u0275fac=function(l){return new(l||m)(i.Y36(f.F0))},m.\u0275cmp=i.Xpm({type:m,selectors:[["app-leads-list"]],viewQuery:function(l,d){if(1&l&&i.Gf(e.Z,5),2&l){let o;i.iGM(o=i.CRH())&&(d.taTableComponent=o.first)}},outputs:{edit:"edit"},standalone:!0,features:[i.jDz],decls:1,vars:1,consts:[[1,"custom-list",3,"options"]],template:function(l,d){1&l&&i._UZ(0,"ta-table",0),2&l&&i.Q6J("options",d.tableConfig)},dependencies:[u.ez,_.l,e.Z]}),m})()},7817:(g,p,s)=>{s.r(p),s.d(p,{LeadsComponent:()=>d});var u=s(6814),i=s(3929),_=s(1602),e=s(5879),f=s(9862),h=s(7127);function m(o,r){1&o&&(e.TgZ(0,"span",17),e._uU(1,"Update Leads"),e.qZA())}function c(o,r){1&o&&(e.TgZ(0,"span",17),e._uU(1,"Create Leads"),e.qZA())}function l(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",18)(1,"app-leads-list",19),e.NdJ("edit",function(n){e.CHM(t);const y=e.oxw();return e.KtG(y.editLeads(n))}),e.qZA()()}}let d=(()=>{class o{set_default_status_id(){return this.http.get("leads/lead_statuses/").subscribe(t=>{if(t&&t.data){const a="status_name",n="Open",C=t.data.filter(L=>L[a]===n)[0].lead_status_id;this.formConfig.model.lead.lead_status_id=C}})}constructor(t){this.http=t,this.showLeadsList=!1,this.showForm=!1,this.formConfig={}}ngOnInit(){this.showLeadsList=!1,this.showForm=!1,this.LeadsEditID=null,this.setFormConfig(),this.set_default_status_id(),this.formConfig.fields[0].fieldGroup[5].hide=!0,this.formConfig.fields[1].hide=!0}hide(){document.getElementById("modalClose").click()}editLeads(t){this.LeadsEditID=t,this.http.get("leads/leads/"+t).subscribe(a=>{a&&a.data&&(this.formConfig.model=a.data,this.formConfig.showActionBtn=!0,this.formConfig.pkId="lead_id",this.formConfig.submit.label="Update",this.formConfig.model.lead_id=this.LeadsEditID,this.showForm=!0,this.formConfig.fields[0].fieldGroup[5].hide=!1,this.formConfig.fields[1].hide=!1)}),this.hide()}showLeadsListFn(){this.showLeadsList=!0,this.leadsListComponent?.refreshTable()}setFormConfig(){this.LeadsEditID=null,this.formConfig={url:"leads/leads/",formState:{viewMode:!1},showActionBtn:!0,exParams:[],submit:{label:"Submit",submittedFn:()=>this.ngOnInit()},reset:{resetFn:()=>{this.ngOnInit()}},model:{lead:{},interaction:{}},fields:[{fieldGroupClassName:"ant-row custom-form-block px-0 mx-0",key:"lead",fieldGroup:[{key:"name",type:"input",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"Name",placeholder:"Enter Name",required:!0},hooks:{onInit:t=>{}}},{key:"email",type:"input",className:"col-md-4 col-sm-6 col-12",templateOptions:{type:"input",label:"Email",placeholder:"Enter Email",required:!0},hooks:{onInit:t=>{}}},{key:"phone",type:"input",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"Phone",placeholder:"Enter Number",required:!0}},{key:"score",type:"input",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"Score",placeholder:"Enter Score"}},{key:"assignee",type:"select",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"Assigned",dataKey:"employee_id",dataLabel:"first_name",options:[],required:!0,lazy:{url:"hrms/employees/",lazyOneTime:!0}},hooks:{onChanges:t=>{t.formControl.valueChanges.subscribe(a=>{this.formConfig&&this.formConfig.model&&this.formConfig.model.lead?this.formConfig.model.lead.assignee_id=a.employee_id:console.error("Form config or lead_status data model is not defined.")})}}},{key:"lead_status",type:"select",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"Lead Status",dataKey:"lead_status_id",dataLabel:"status_name",options:[],lazy:{url:"leads/lead_statuses/",lazyOneTime:!0}},hooks:{onChanges:t=>{t.formControl.valueChanges.subscribe(a=>{this.formConfig&&this.formConfig.model&&this.formConfig.model.lead?this.formConfig.model.lead.lead_status_id=a.lead_status_id:console.error("Form config or lead_status data model is not defined.")})}}}]},{key:"interaction",type:"table",className:"custom-form-list",templateOptions:{title:"Lead Interactions",addText:"Add Interaction Notes",tableCols:[{name:"interaction_type_id",label:"Interaction Type"},{name:"interaction_date",label:"Interaction Date"},{name:"notes",label:"Notes"}]},fieldArray:{fieldGroup:[{key:"interaction_type",type:"select",templateOptions:{label:"Interaction Type",dataKey:"interaction_type_id",dataLabel:"interaction_type",options:[],hideLabel:!0,required:!0,lazy:{url:"leads/interaction_types/",lazyOneTime:!0}},hooks:{onChanges:t=>{t.formControl.valueChanges.subscribe(a=>{console.log("user",a);const n=t.parent.key;this.formConfig.model.interaction[n]||(console.error(`Task comments at index ${n} is not defined. Initializing...`),this.formConfig.model.interaction[n]={}),this.formConfig.model.interaction[n].interaction_type_id=a.interaction_type_id})}}},{key:"interaction_date",type:"date",templateOptions:{label:"Interaction Date",hideLabel:!0,required:!0}},{key:"notes",type:"text",templateOptions:{label:"Notes",placeholder:"Enter Notes",hideLabel:!0,required:!0}}]}}]}}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.eN))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-leads"]],viewQuery:function(t,a){if(1&t&&e.Gf(_.H,5),2&t){let n;e.iGM(n=e.CRH())&&(a.leadsListComponent=n.first)}},standalone:!0,features:[e.jDz],decls:22,vars:4,consts:[[1,"container-fluid","p-3"],[1,"leads-banner"],[1,"col-12","px-0",2,"display","flex","justify-content","space-between","align-items","center","flex-wrap","wrap"],["type","button",1,"btn","pl-0",2,"color","black",3,"click"],["class","custom-heading",4,"ngIf"],["type","button","data-bs-toggle","modal","data-bs-target","#leadsListModal",1,"btn","btn-primary",3,"click"],[1,"row","custom-form"],[3,"options"],["id","leadsListModal","tabindex","-1","aria-labelledby","leadsListModalLabel","aria-hidden","true",1,"modal","fade","custom-modal"],[1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header"],["id","leadsListModalLabel",1,"modal-title"],["type","button","id","modalClose","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],["class","modal-body",4,"ngIf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-danger"],[1,"custom-heading"],[1,"modal-body"],[1,"custom-list",3,"edit"]],template:function(t,a){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),e.NdJ("click",function(){return a.LeadsEditID=null}),e.YNc(4,m,2,0,"span",4),e.YNc(5,c,2,0,"span",4),e.qZA(),e.TgZ(6,"button",5),e.NdJ("click",function(){return a.showLeadsListFn()}),e._uU(7," Leads List "),e.qZA()()(),e.TgZ(8,"div",6)(9,"div"),e._UZ(10,"ta-form",7),e.qZA()()(),e.TgZ(11,"div",8)(12,"div",9)(13,"div",10)(14,"div",11)(15,"h5",12),e._uU(16,"Edit Leads List"),e.qZA(),e._UZ(17,"button",13),e.qZA(),e.YNc(18,l,2,0,"div",14),e.TgZ(19,"div",15)(20,"button",16),e._uU(21,"Close"),e.qZA()()()()()),2&t&&(e.xp6(4),e.Q6J("ngIf",a.LeadsEditID),e.xp6(1),e.Q6J("ngIf",!a.LeadsEditID),e.xp6(5),e.Q6J("options",a.formConfig),e.xp6(8),e.Q6J("ngIf",a.showLeadsList))},dependencies:[u.ez,u.O5,i.l,h.C,_.H]}),o})()}}]);