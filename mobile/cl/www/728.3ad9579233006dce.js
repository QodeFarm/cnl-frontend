"use strict";(self.webpackChunkcnl=self.webpackChunkcnl||[]).push([[728],{4728:(C,r,n)=>{n.r(r),n.d(r,{WorkflowComponent:()=>g});var a=n(6814),f=n(3929),o=n(5879),d=n(7871),w=n(2787);let m=(()=>{class s{refreshTable(){this.taTableComponent?.refresh()}constructor(t){this.router=t,this.edit=new o.vpe,this.tableConfig={apiUrl:"sales/work_flow",showCheckbox:!0,pkId:"workflow_id",pageSize:10,globalSearch:{keys:["workflow_id","name"]},defaultSort:{key:"created_at",value:"descend"},cols:[{fieldKey:"name",name:"Workflow Name",sort:!0},{fieldKey:"actions",name:"Actions",type:"action",actions:[{type:"delete",label:"Delete",confirm:!0,confirmMsg:"Sure to delete?",apiUrl:"sales/work_flow"},{type:"callBackFn",icon:"fa fa-pen",label:"",callBackFn:(e,l)=>{this.edit.emit(e.workflow_id)}}]}]}}}return s.\u0275fac=function(t){return new(t||s)(o.Y36(w.F0))},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-workflow-list"]],viewQuery:function(t,e){if(1&t&&o.Gf(d.Z,5),2&t){let l;o.iGM(l=o.CRH())&&(e.taTableComponent=l.first)}},outputs:{edit:"edit"},standalone:!0,features:[o.jDz],decls:1,vars:1,consts:[[1,"custom-list",3,"options"]],template:function(t,e){1&t&&o._UZ(0,"ta-table",0),2&t&&o.Q6J("options",e.tableConfig)},dependencies:[a.ez,f.l,d.Z]}),s})();var c=n(9862),p=n(7127);function u(s,i){1&s&&(o.TgZ(0,"span",18),o._uU(1,"Update Workflow"),o.qZA())}function k(s,i){1&s&&(o.TgZ(0,"span",18),o._uU(1,"Create Workflow"),o.qZA())}function h(s,i){if(1&s){const t=o.EpF();o.TgZ(0,"div",19)(1,"app-workflow-list",20),o.NdJ("edit",function(l){o.CHM(t);const b=o.oxw();return o.KtG(b.editWorkflow(l))}),o.qZA()()}}let g=(()=>{class s{constructor(t){this.http=t,this.showWorkflowList=!1,this.showForm=!1,this.formConfig={}}ngOnInit(){this.showWorkflowList=!1,this.showForm=!1,this.workflowEditID=null,this.setFormConfig()}hide(){document.getElementById("modalClose")?.click()}editWorkflow(t){this.workflowEditID=t,this.http.get("sales/work_flow/"+t).subscribe(e=>{e&&e.data&&(this.formConfig.model=e.data,this.formConfig.showActionBtn=!0,this.formConfig.pkId="workflow_id",this.formConfig.submit.label="Update",this.formConfig.model.workflow_id=this.workflowEditID,this.showForm=!0)}),this.hide()}showWorkflowListFn(){this.showWorkflowList=!0,this.WorkflowListComponent?.refreshTable()}setFormConfig(){this.workflowEditID=null,this.formConfig={url:"sales/work_flow/",formState:{viewMode:!1},showActionBtn:!0,submit:{label:"Submit",submittedFn:()=>this.ngOnInit()},reset:{resetFn:()=>{this.ngOnInit()}},model:{workflow:{},workflow_stages:[{}]},fields:[{fieldGroupClassName:"ant-row custom-form-block px-0 mx-0",key:"workflow",fieldGroup:[{key:"name",type:"input",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"Workflow Name",placeholder:"Enter Workflow Name"}},{key:"is_active",type:"checkbox",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"Is Active"}}]},{key:"workflow_stages",type:"table",className:"custom-form-list product-table",templateOptions:{title:"Workflow Stages",addText:"Add Stage",tableCols:[{name:"stage_order",label:"Stage Order"},{name:"description",label:"Description"}]},fieldArray:{fieldGroup:[{key:"section",type:"select",templateOptions:{label:"Section name",dataKey:"section_id",dataLabel:"section_name",hideLabel:!0,options:[],lazy:{url:"users/module_sections/",lazyOneTime:!0}},hooks:{onChanges:t=>{t.formControl.valueChanges.subscribe(e=>{const l=t.parent.key;this.formConfig.model.workflow_stages[l]||(console.error(`Workflow stage at index ${l} is not defined. Initializing...`),this.formConfig.model.workflow_stages[l]={}),this.formConfig.model.workflow_stages[l].section_id=e.section_id})}}},{key:"flow_status",type:"select",templateOptions:{label:"Flow Status Name",dataKey:"flow_status_id",dataLabel:"flow_status_name",hideLabel:!0,options:[],lazy:{url:"masters/flow_status/",lazyOneTime:!0}},hooks:{onChanges:t=>{t.formControl.valueChanges.subscribe(e=>{const l=t.parent.key;this.formConfig.model.workflow_stages[l]||(console.error(`Workflow stage at index ${l} is not defined. Initializing...`),this.formConfig.model.workflow_stages[l]={}),this.formConfig.model.workflow_stages[l].flow_status_id=e.flow_status_id})}}},{key:"stage_order",type:"input",templateOptions:{label:"Stage Order",placeholder:"Enter Stage Order",type:"number",hideLabel:!0}},{key:"description",type:"input",templateOptions:{label:"Description",placeholder:"Enter Description",hideLabel:!0}}]}}]}}}return s.\u0275fac=function(t){return new(t||s)(o.Y36(c.eN))},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-workflow"]],viewQuery:function(t,e){if(1&t&&o.Gf(m,5),2&t){let l;o.iGM(l=o.CRH())&&(e.WorkflowListComponent=l.first)}},standalone:!0,features:[o.jDz],decls:22,vars:4,consts:[[1,"container-fluid","ps-3"],[1,"workflow-banner"],[1,"col-12","px-0",2,"display","flex","justify-content","space-between","align-items","center","flex-wrap","wrap"],["type","button",1,"btn","pl-0",2,"color","black",3,"click"],["class","custom-heading",4,"ngIf"],["type","button","data-bs-toggle","modal","data-bs-target","#workflowListModal",1,"btn","btn-primary",3,"click"],[1,"row","custom-form"],[1,"p-0"],[3,"options"],["id","workflowListModal","tabindex","-1","aria-labelledby","workflowListModalLabel","aria-hidden","true",1,"modal","fade","custom-modal"],[1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header"],["id","workflowListModalLabel",1,"modal-title"],["type","button","id","modalClose","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],["class","modal-body",4,"ngIf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-danger"],[1,"custom-heading"],[1,"modal-body"],[1,"custom-list",3,"edit"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),o.NdJ("click",function(){return e.workflowEditID=null}),o.YNc(4,u,2,0,"span",4),o.YNc(5,k,2,0,"span",4),o.qZA(),o.TgZ(6,"button",5),o.NdJ("click",function(){return e.showWorkflowListFn()}),o._uU(7," Workflow List "),o.qZA()()(),o.TgZ(8,"div",6)(9,"div",7),o._UZ(10,"ta-form",8),o.qZA()()(),o.TgZ(11,"div",9)(12,"div",10)(13,"div",11)(14,"div",12)(15,"h5",13),o._uU(16,"Edit Workflow List"),o.qZA(),o._UZ(17,"button",14),o.qZA(),o.YNc(18,h,2,0,"div",15),o.TgZ(19,"div",16)(20,"button",17),o._uU(21,"Close"),o.qZA()()()()()),2&t&&(o.xp6(4),o.Q6J("ngIf",e.workflowEditID),o.xp6(1),o.Q6J("ngIf",!e.workflowEditID),o.xp6(5),o.Q6J("options",e.formConfig),o.xp6(8),o.Q6J("ngIf",e.showWorkflowList))},dependencies:[a.ez,a.O5,f.l,p.C,m]}),s})()}}]);