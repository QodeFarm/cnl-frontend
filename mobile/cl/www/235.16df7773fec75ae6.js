"use strict";(self.webpackChunkcnl=self.webpackChunkcnl||[]).push([[235],{8235:(M,y,m)=>{m.r(y),m.d(y,{BomComponent:()=>I});var _=m(6814),C=m(3929),o=m(5879),g=m(7871),B=m(2787);let z=(()=>{class l{refreshTable(){this.taTableComponent?.refresh()}constructor(t){this.router=t,this.edit=new o.vpe,this.tableConfig={apiUrl:"production/bom",showCheckbox:!0,pkId:"bom_id",pageSize:10,globalSearch:{keys:["created_at","bom","notes","product"]},defaultSort:{key:"created_at",value:"descend"},cols:[{fieldKey:"bom",name:"BOM Name",sort:!0,displayType:"map",mapFn:(e,i,s)=>`${i.bom_name}`},{fieldKey:"product",name:"Product",displayType:"map",mapFn:(e,i,s)=>`${i.product.name}`,sort:!0},{fieldKey:"notes",name:"Notes",sort:!0},{fieldKey:"code",name:"Action",type:"action",actions:[{type:"delete",label:"Delete",confirm:!0,confirmMsg:"Sure to delete?",apiUrl:"production/bom"},{type:"callBackFn",icon:"fa fa-pen",label:"",callBackFn:(e,i)=>{console.log(e),this.edit.emit(e.bom_id)}}]}]}}}return l.\u0275fac=function(t){return new(t||l)(o.Y36(B.F0))},l.\u0275cmp=o.Xpm({type:l,selectors:[["app-bom-list"]],viewQuery:function(t,e){if(1&t&&o.Gf(g.Z,5),2&t){let i;o.iGM(i=o.CRH())&&(e.taTableComponent=i.first)}},outputs:{edit:"edit"},standalone:!0,features:[o.jDz],decls:1,vars:1,consts:[[3,"options"]],template:function(t,e){1&t&&o._UZ(0,"ta-table",0),2&t&&o.Q6J("options",e.tableConfig)},dependencies:[_.ez,C.l,g.Z]}),l})();var v=m(9862),k=m(7127);function O(l,d){1&l&&(o.TgZ(0,"span",17),o._uU(1,"Update BOM"),o.qZA())}function T(l,d){1&l&&(o.TgZ(0,"span",17),o._uU(1,"Create BOM"),o.qZA())}function L(l,d){if(1&l){const t=o.EpF();o.TgZ(0,"div",18)(1,"app-bom-list",19),o.NdJ("edit",function(i){o.CHM(t);const s=o.oxw();return o.KtG(s.editBom(i))}),o.qZA()()}}let I=(()=>{class l{constructor(t,e,i){this.http=t,this.route=e,this.cdRef=i,this.showBomList=!1,this.showForm=!1,this.formConfig={}}ngOnInit(){this.showBomList=!1,this.showForm=!1,this.BomEditID=null,this.setFormConfig()}hide(){document.getElementById("modalClose").click()}editBom(t){this.BomEditID=t,this.http.get("production/bom/"+t).subscribe(e=>{e&&e.data&&(this.formConfig.model=e.data,this.formConfig.showActionBtn=!0,this.formConfig.pkId="bom_id",this.formConfig.submit.label="Update",this.formConfig.model.bom_id=this.BomEditID,this.showForm=!0)}),this.hide()}showBomListFn(){this.showBomList=!0,this.BomListComponent?.refreshTable()}loadProductVariations(t,e=!1){const i=t.parent,s=t.formControl.value;if(s?.product_id){const a=i.fieldGroup.find(n=>"size"===n.key),c=i.fieldGroup.find(n=>"color"===n.key);e&&(a.formControl.setValue(null),c.formControl.setValue(null)),a&&(a.templateOptions.options=[]),c&&(c.templateOptions.options=[]),this.http.get(`products/product_variations/?product_id=${s.product_id}`).subscribe(n=>{if(n.data.length>0){let f,b;n.data&&n.data.length>0?(f=n.data.map(r=>({label:r.size?.size_name||"----",value:{size_id:r.size?.size_id||null,size_name:r.size?.size_name||"----"}})),b=n.data.map(r=>({label:r.color?.color_name||"----",value:{color_id:r.color?.color_id||null,color_name:r.color?.color_name||"----"}})),a&&(a.formControl.enable(),a.templateOptions.options=f.filter((r,p,h)=>p===h.findIndex(u=>u.value.size_id===r.value.size_id)))):(a&&(a.templateOptions.options=[]),c&&(c.templateOptions.options=[]))}})}else console.error("Product not selected or invalid.")}setFormConfig(){this.BomEditID=null,this.formConfig={url:"production/bom/",formState:{viewMode:!1},showActionBtn:!0,exParams:[],submit:{label:"Submit",submittedFn:()=>this.ngOnInit()},reset:{resetFn:()=>{this.ngOnInit()}},model:{bom:{},bill_of_material:[{}]},fields:[{fieldGroupClassName:"ant-row custom-form-block px-0 mx-0",key:"bom",fieldGroup:[{key:"bom_name",type:"input",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"BOM Name",placeholder:"Enter BOM Name",required:!0},hooks:{onInit:t=>{}}},{key:"product",type:"select",className:"col-md-4 col-sm-6 col-12",templateOptions:{label:"Product",dataKey:"product_id",dataLabel:"name",options:[],required:!0,lazy:{url:"products/products/",lazyOneTime:!0}},hooks:{onChanges:t=>{t.formControl.valueChanges.subscribe(e=>{this.formConfig&&this.formConfig.model&&this.formConfig.model.bom?this.formConfig.model.bom.product_id=e.product_id:console.error("Form config or product data model is not defined.")})}}},{key:"notes",type:"textarea",className:"col-md-4 col-sm-6 col-12",templateOptions:{type:"input",label:"Notes",placeholder:"Enter Notes",required:!1},hooks:{onInit:t=>{}}}]},{key:"bill_of_material",type:"table",className:"custom-form-list",templateOptions:{title:"Bill Of Material",addText:"Add Materials",tableCols:[{name:"product_id",label:"Product"},{name:"size_id",label:"Size"},{name:"color_id",label:"Color"},{name:"quantity",label:"Quantity"},{name:"unit_cost",label:"Unit Cost"},{name:"total_cost",label:"Total Cost"},{name:"notes",label:"Notes"}]},fieldArray:{fieldGroup:[{key:"product",type:"select",templateOptions:{label:"Product",dataKey:"product_id",hideLabel:!0,dataLabel:"name",placeholder:"product",options:[],required:!0,lazy:{url:"products/products/?summary=true",lazyOneTime:!0}},hooks:{onInit:t=>{const e=t.parent;if(!e)return void console.error("Parent array is undefined or not accessible");const i=+e.key,s=this.dataToPopulate?.bill_of_material?.[i]?.product;s&&t.formControl.setValue(s),this.loadProductVariations(t),t.formControl.valueChanges.subscribe(a=>{this.formConfig.model.bill_of_material[i]||(console.error(`Products at index ${i} is not defined. Initializing...`),this.formConfig.model.bill_of_material[i]={}),this.formConfig.model.bill_of_material[i].product_id=a?.product_id,this.loadProductVariations(t)})}}},{key:"size",type:"select",templateOptions:{label:"Size",dataKey:"size_id",hideLabel:!0,dataLabel:"size_name",placeholder:"size",options:[],required:!1,lazy:{lazyOneTime:!0}},hooks:{onInit:t=>{const e=t.parent;if(!e)return void console.error("Parent array is undefined or not accessible");const i=+e.key,a=this.dataToPopulate?.bill_of_material?.[i]?.size;a?.size_id&&t.formControl.setValue(a),t.formControl.valueChanges.subscribe(c=>{const n=this.formConfig.model.bill_of_material[i]?.product;if(!n?.product_id)return void console.warn(`Product missing for row ${i}, skipping color fetch.`);const f=c?.size_id||null;this.http.get(f?`products/product_variations/?product_id=${n.product_id}&size_id=${f}`:`products/product_variations/?product_id=${n.product_id}&size_isnull=True`).subscribe(r=>{const p=r.data.map(u=>({label:u.color?.color_name||"----",value:{color_id:u.color?.color_id||null,color_name:u.color?.color_name||"----"}})).filter((u,w,x)=>w===x.findIndex(F=>F.value.color_id===u.value.color_id)),h=e.fieldGroup.find(u=>"color"===u.key);h&&(h.templateOptions.options=p)}),this.formConfig?.model?.bill_of_material?this.formConfig.model.bill_of_material[i].size_id=c?.size_id:console.error("Form config or model is not defined.")})}}},{key:"color",type:"select",templateOptions:{label:"Color",dataKey:"color_id",hideLabel:!0,dataLabel:"color_name",placeholder:"color",options:[],required:!1,lazy:{lazyOneTime:!0}},hooks:{onInit:t=>{const e=t.parent;if(!e)return void console.error("Parent array is undefined or not accessible");const i=+e.key,a=this.dataToPopulate?.bill_of_material?.[i]?.color;a&&t.formControl.setValue(a),t.formControl.valueChanges.subscribe(c=>{const n=this.formConfig.model.bill_of_material[i];if(!n?.product?.product_id)return void console.warn(`Product missing for row ${i}, skipping color update.`);const{product:f,size:b,color:r}=n,p=new URLSearchParams({product_id:f.product_id});r?.color_id?p.append("color_id",r.color_id):p.append("color_isnull","True"),b?.size_id?p.append("size_id",b.size_id):p.append("size_isnull","True"),n.color_id=r?.color_id||null})}}},{key:"quantity",type:"input",templateOptions:{label:"Quantity",placeholder:"Enter Quantity",hideLabel:!0,required:!0,type:"number"}},{key:"unit_cost",type:"input",templateOptions:{label:"Unit Cost",placeholder:"Enter Unit Cost",hideLabel:!0,required:!0,type:"number"},hooks:{onInit:t=>{t.formControl.valueChanges.subscribe(e=>{if(t.form&&t.form.controls&&t.form.controls.quantity&&t.form.controls.unit_cost&&e){const i=t.form.controls.quantity.value,s=t.form.controls.unit_cost.value;i&&s&&t.form.controls.total_cost.setValue(parseInt(i)*parseInt(s))}else t.form.controls.total_cost.setValue(0)})}}},{key:"total_cost",type:"input",templateOptions:{label:"Total Cost",placeholder:"Enter Total Cost",hideLabel:!0,required:!0,disabled:!0}},{key:"notes",type:"text",templateOptions:{label:"Notes",placeholder:"Enter Notes",hideLabel:!0,required:!1}}]}}]}}}return l.\u0275fac=function(t){return new(t||l)(o.Y36(v.eN),o.Y36(B.gz),o.Y36(o.sBO))},l.\u0275cmp=o.Xpm({type:l,selectors:[["app-bom"]],viewQuery:function(t,e){if(1&t&&o.Gf(z,5),2&t){let i;o.iGM(i=o.CRH())&&(e.BomListComponent=i.first)}},standalone:!0,features:[o.jDz],decls:22,vars:4,consts:[[1,"container-fluid","p-3"],[1,"Bom-banner"],[1,"col-12","px-0",2,"display","flex","justify-content","space-between","align-items","center","flex-wrap","wrap"],["type","button",1,"btn","pl-0",2,"color","black",3,"click"],["class","custom-heading",4,"ngIf"],["type","button","data-bs-toggle","modal","data-bs-target","#BomListModal",1,"btn","btn-primary",3,"click"],[1,"row","custom-form"],[3,"options"],["id","BomListModal","tabindex","-1","aria-labelledby","BomListModalLabel","aria-hidden","true",1,"modal","fade","custom-modal"],[1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header"],["id","BomListModalLabel",1,"modal-title"],["type","button","id","modalClose","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],["class","modal-body",4,"ngIf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-danger"],[1,"custom-heading"],[1,"modal-body"],[1,"custom-list",3,"edit"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),o.NdJ("click",function(){return e.BomEditID=null}),o.YNc(4,O,2,0,"span",4),o.YNc(5,T,2,0,"span",4),o.qZA(),o.TgZ(6,"button",5),o.NdJ("click",function(){return e.showBomListFn()}),o._uU(7," BOM List "),o.qZA()()(),o.TgZ(8,"div",6)(9,"div"),o._UZ(10,"ta-form",7),o.qZA()()(),o.TgZ(11,"div",8)(12,"div",9)(13,"div",10)(14,"div",11)(15,"h5",12),o._uU(16,"Edit BOM List"),o.qZA(),o._UZ(17,"button",13),o.qZA(),o.YNc(18,L,2,0,"div",14),o.TgZ(19,"div",15)(20,"button",16),o._uU(21,"Close"),o.qZA()()()()()),2&t&&(o.xp6(4),o.Q6J("ngIf",e.BomEditID),o.xp6(1),o.Q6J("ngIf",!e.BomEditID),o.xp6(5),o.Q6J("options",e.formConfig),o.xp6(8),o.Q6J("ngIf",e.showBomList))},dependencies:[_.ez,_.O5,C.l,k.C,z]}),l})()}}]);